<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="admiralci">
<title>Codespaces • admiralci</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Codespaces">
<meta property="og:description" content="admiralci">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">admiralci</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-basics">Basics</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-basics">
    <a class="dropdown-item" href="../articles/common_structure.html">Common structure of the workflows</a>
    <a class="dropdown-item" href="../articles/cheatsheet.html">Cheatsheet</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-workflows-details">Workflows Details</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-workflows-details">
    <a class="dropdown-item" href="../articles/r-cmd-checks.html">R CMD CHECKS</a>
    <a class="dropdown-item" href="../articles/cran-status.html">Cran Status</a>
    <a class="dropdown-item" href="../articles/code-coverage.html">Code Coverage</a>
    <a class="dropdown-item" href="../articles/check-templates.html">Check Templates</a>
    <a class="dropdown-item" href="../articles/links.html">Links (Check broken links)</a>
    <a class="dropdown-item" href="../articles/lintr.html">Lintr (Code lints)</a>
    <a class="dropdown-item" href="../articles/style.html">Style (Code style)</a>
    <a class="dropdown-item" href="../articles/spellchecks.html">Spellchecks</a>
    <a class="dropdown-item" href="../articles/man-pages.html">Man pages (Code Doc Rendering)</a>
    <a class="dropdown-item" href="../Readme.Rmd">Readme Render (Readme.Rmd -&gt; Readme.md)</a>
    <a class="dropdown-item" href="../articles/pkgdown.html">Pkgdown (build doc from Vignettes)</a>
    <a class="dropdown-item" href="../articles/tweak-page-hooks.html">Tweak Pages (fix pkgdown broken links)</a>
    <a class="dropdown-item" href="../articles/pkgdown.html">Pkgdown (build doc from Vignettes)</a>
    <a class="dropdown-item" href="../articles/validation.html">Validation (build PDF validation report)</a>
    <a class="dropdown-item" href="../articles/push-docker.html">Push Docker Images</a>
    <a class="dropdown-item" href="../articles/docker_and_codespaces.html">Codespaces</a>
    <a class="dropdown-item" href="../articles/propagate.html">Propagate (share codespaces conf)</a>
    <a class="dropdown-item" href="../articles/check-r-tags.html">Check R latest version</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://app.slack.com/client/T028PB489D3/C02M8KN8269" aria-label="Slack">
    <span class="fa fa-slack"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/pharmaverse/admiralci/issues/new/choose" aria-label="New Issue">
    <span class="fa fa-bug"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/pharmaverse/admiralci/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Codespaces</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pharmaverse/admiralci/blob/HEAD/vignettes/docker_and_codespaces.Rmd" class="external-link"><code>vignettes/docker_and_codespaces.Rmd</code></a></small>
      <div class="d-none name"><code>docker_and_codespaces.Rmd</code></div>
    </div>

    
    
<!-- TODO: some screenshots are still under dgrassellyb forked repo - change it once everything merged on admiralci/main -->
<p>WARNING: this article is outdated (codespaces need to be re-designed
since we decided to stop handling dependencies with renv) - WIP</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This article will go over the following:</p>
<ul>
<li>What are codespaces, why we are using it for Admiral, and how to use
them.</li>
<li>How codespaces are built (this section concerns more admiralci
developers to be able to maintain codespaces - it’s not needed to use
codespaces, but interesting for users that want to learn more about
admiral CI/CD processes).</li>
</ul>
<p>Go <a href="https://www.youtube.com/watch?v=VUGeXqz_TXo&amp;list=PLn-mqs_tEh86kA-UzWHeVZWIQNm6qvr_z&amp;index=14" class="external-link">here</a>
to watch codespaces demo !</p>
<div class="section level3">
<h3 id="what-are-codespaces-and-how-to-use-them">What are codespaces and how to use them<a class="anchor" aria-label="anchor" href="#what-are-codespaces-and-how-to-use-them"></a>
</h3>
<div class="section level4">
<h4 id="what-are-codespaces-and-why-are-we-using-it-for-admiral">What are codespaces, and why are we using it for Admiral ?<a class="anchor" aria-label="anchor" href="#what-are-codespaces-and-why-are-we-using-it-for-admiral"></a>
</h4>
<p>Codespaces are development environments hosted in the cloud. These
environment are running on virtual machines and can be customized. For
<code>admiral</code> we setup custom codespaces with all admiral
dependencies installed (system dependencies, renv.lock files packages,
staged dependencies from <code>staged_dependencies.yaml</code> file).
Then every contributors of admiral can use these codespaces and run
Rstudio in their web browsers as a development environment, without
having to install locally every dependencies, and without any
compatibility problem with their local machines / operating system.</p>
</div>
<div class="section level4">
<h4 id="how-to-use-codespaces">How to use codespaces<a class="anchor" aria-label="anchor" href="#how-to-use-codespaces"></a>
</h4>
<div class="section level5">
<h5 id="create-a-codespace">Create a codespace<a class="anchor" aria-label="anchor" href="#create-a-codespace"></a>
</h5>
<p>On the main repository, go under <code>&lt;&gt; Code</code> menu
-&gt; <code>Codespaces</code> -&gt; <code>...</code> -&gt;
<code>+ New with options</code>.</p>
<p><img src="assets/create_codespaces_1.png"><!-- --></p>
<p>Then this menu will appear :</p>
<p><img src="assets/create_codespaces_2.png"><!-- --></p>
<p>Go under <code>Dev container configuration</code> drop-down menu, and
select the codespaces wished (you can choose between several R
versions). Note: Pressing directly <code>+</code> button will
automatically create codespace for the latest R version available
(<code>4.2</code>).</p>
</div>
<div class="section level5">
<h5 id="accessing-rstudio">Accessing Rstudio<a class="anchor" aria-label="anchor" href="#accessing-rstudio"></a>
</h5>
<p>To open rstudio in your browser, type <code>rstudio</code> on your
current terminal. This script will wait until rstudio server is ready,
and display the url in the terminal.</p>
<p>Known issue:</p>
<p>Sometimes ports are not automatically forwarded at the codespace
creation. If you have some problems trying to access rstudio url, check
the PORTS section on vscode :</p>
<p><img src="assets/codespaces_rstudio_forward_port.png"><!-- --></p>
<p>If you don’t see <code>8787</code> port, then you need to manually
add it (using “Add Port” button).</p>
</div>
</div>
<div class="section level4">
<h4 id="usage-limit-pricing">Usage limit / Pricing<a class="anchor" aria-label="anchor" href="#usage-limit-pricing"></a>
</h4>
<p>The following storage and core hours of usage are included, free of
charge, for personal accounts:</p>
<ul>
<li>GitHub Free for personal accounts:
<ul>
<li>Storage per month:15 GB</li>
<li>Core hours per month: 120</li>
</ul>
</li>
<li>GitHub Pro:
<ul>
<li>Storage per month:20 GB</li>
<li>Core hours per month: 180</li>
</ul>
</li>
</ul>
<p>For more details, see the <a href="https://docs.github.com/en/billing/managing-billing-for-github-codespaces/about-billing-for-github-codespaces" class="external-link">github
codespaces billing</a></p>
</div>
</div>
<div class="section level3">
<h3 id="codespaces-building-process-for-admiralci-developers">Codespaces building process (for admiralci developers)<a class="anchor" aria-label="anchor" href="#codespaces-building-process-for-admiralci-developers"></a>
</h3>
<div class="section level4">
<h4 id="base-docker-image">Base docker image<a class="anchor" aria-label="anchor" href="#base-docker-image"></a>
</h4>
<p>Our codespaces are using a base docker image. These image is located
inside <a href="https://github.com/orgs/pharmaverse/packages?repo_name=admiralci" class="external-link">admiralci
container registry</a>. Admiral is configured to be used with several
versions of R. These versions are defined under
<code>renv/profiles</code> folder (with an associated
<code>renv.lock</code> file). Therefore, there is a docker image
available for each <code>R_VERSION</code> named
<code>admiralci-{R_VERSION}</code>. Note that the building step for
these images is described <a href="../README.md/#docker-image-build">here</a>. There is a codespace
configuration available for each <code>R_VERSION</code>, based on its
associated docker image <code>admiralci-{R_VERSION}</code>.</p>
</div>
<div class="section level4">
<h4 id="devcontainer-json-files">
<code>.devcontainer.json</code> files<a class="anchor" aria-label="anchor" href="#devcontainer-json-files"></a>
</h4>
<p>Codespaces configuration are defined under
<code>.devcontainer.json</code> files (inside <code>.devcontainer</code>
folder). There is a <code>.devcontainer.json</code> file defined for
each R version. Every json fields are described here : <a href="https://containers.dev/implementors/json_reference/" class="external-link uri">https://containers.dev/implementors/json_reference/</a>.</p>
<p>In our case we are using following configuration:</p>
<ul>
<li><p><code>name</code> : Name of the devcontainer displayed in the web
browser</p></li>
<li><p><code>image</code> : Base docker image for the codespace (in our
case ghcr admiralci based image)</p></li>
<li><p><code>features</code>: (see <a href="https://github.com/rocker-org/devcontainer-features" class="external-link uri">https://github.com/rocker-org/devcontainer-features</a> for
every available features for rocker containers). We use r-rig feature to
install R and some dependencies + vscode requirements.</p></li>
<li><p><code>customizations</code>: used to customize IDE (vscode)
settings.</p></li>
<li><p><code>forwardPorts</code> / <code>portsAttributes</code>: Rstudio
ports configuration.</p></li>
<li><p><code>updateContentCommand</code>: used to run
staged.dependencies installation (for more details see <a href="https://github.com/openpharma/staged.dependencies" class="external-link">staged
dependencies doc</a>)</p></li>
<li><p><code>postCreateCommand</code>: command launched after the
container creation (in our case we activate the proper R profile from
<code>renv/profiles</code> folder).</p></li>
<li><p>Note that Commands <code>postCreateCommand</code>,
<code>updateContentCommand</code> (and also <code>onCreateCommand</code>
but not used here) are always run to finalize container setup. they are
run in this following order : <code>onCreateCommand</code> &gt;
<code>updateContentCommand</code> &gt;
<code>postCreateCommand</code>.</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="prebuild-codespaces">Prebuild codespaces<a class="anchor" aria-label="anchor" href="#prebuild-codespaces"></a>
</h4>
<p>In settings -&gt; codespaces, you can see “Set up prebuild”. This
feature allow to prebuild codespaces to be able to speed up users
codespaces creation. On the main configuration menu, the branch
containing codespaces has to be selected, and there is a drop-down menu
where an user can select one of the .devcontainer.json configuration.
There is also the “prebuild triggers” menu to configure when to run a
prebuild for a given .devcontainer.json file. For every
<code>admiralci</code> codespace we choose the “On configuration change”
trigger.</p>
<p><img src="assets/prebuild_conf.png"><!-- --></p>
<p>Then when a user is creating a codespace, he will see this message
“prebuild ready” - it will speed-up the codespace creation.</p>
<p><img src="assets/prebuild_ready.png"><!-- --></p>
</div>
<div class="section level4">
<h4 id="propagation">Propagation<a class="anchor" aria-label="anchor" href="#propagation"></a>
</h4>
<p>Each time a change is detected inside .devcontainer folder, the <a href="https://github.com/pharmaverse/admiralci/blob/HEAD/.github/workflows/propagate.yml">propagation job</a> will be
triggered.</p>
</div>
<div class="section level4">
<h4 id="improvement-ideas">Improvement ideas<a class="anchor" aria-label="anchor" href="#improvement-ideas"></a>
</h4>
<p>We can see that every .devcontainer.json files have the same
structure. the only variant is the based docker image depending on the R
version. We could define an action in our CI/CD workflow to
auto-generate these .devcontainer files based on
<code>renv/profile</code> folder.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Dinakar Kulkarni, Daphne Grasselly, Adam Forys, Franciszek Walkowiak.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
